---
import WebsiteLayout from '../layouts/WebsiteLayout.astro'
import { GlobalHomepage } from '../components/GlobalHomepage'
import { getLabs, getCourses, getProjects, getArticles, getImpactStats } from '../lib/api'

const labs = await getLabs()
const allCourses = await getCourses()
const allProjects = await getProjects()
const allArticles = await getArticles()
const impactStats = await getImpactStats()

const featuredCourses = allCourses.filter(c => c.isFeatured).slice(0, 4)
const featuredProjects = allProjects.filter(p => p.status === 'completed' || p.status === 'in-progress').slice(0, 4)
const featuredArticles = allArticles.filter(a => a.isFeatured).slice(0, 4)

// Fallback if not enough featured items
if (featuredCourses.length === 0) featuredCourses.push(...allCourses.slice(0, 4))
if (featuredProjects.length === 0) featuredProjects.push(...allProjects.slice(0, 4))
if (featuredArticles.length === 0) featuredArticles.push(...allArticles.slice(0, 4))
---

<WebsiteLayout title="Accueil" description="Semisto — Réseau européen de jardins-forêts. Conception, formation, plantation." transparentHeader>
  <GlobalHomepage
    client:only="react"
    labs={labs}
    featuredCourses={featuredCourses}
    featuredProjects={featuredProjects}
    featuredArticles={featuredArticles}
    impactStats={impactStats}
  />
</WebsiteLayout>
