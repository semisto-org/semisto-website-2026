---
import PortalLayout from '../../../layouts/PortalLayout.astro'
import { FundingDetail } from '../../../components/portal/FundingDetail'
import { getFundingProposalById, getFundings } from '../../../lib/portal-api'

export const prerender = false

const { proposalId } = Astro.params
const proposal = getFundingProposalById(proposalId || '')
const fundings = getFundings()

if (!proposal) {
  return Astro.redirect('/portal/funding/')
}
---

<PortalLayout title={`${proposal.title} — Espace Partenaire Semisto`} activePage="funding">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <FundingDetail
      client:load
      proposal={proposal}
      existingFundings={fundings}
      onBack={() => { window.location.href = '/portal/funding/' }}
      onFund={(id, amount) => alert(`Financement de ${amount}€ alloué au projet ${id} !`)}
    />
  </div>
</PortalLayout>
